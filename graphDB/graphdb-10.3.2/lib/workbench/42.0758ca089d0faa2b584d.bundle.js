(window.webpackJsonp=window.webpackJsonp||[]).push([[42,135],{40:function(n,e){function t(n,e){return{showToastMessageWithDelay:function(t){return new Promise(r=>{n.success(e.instant(t)),setTimeout(r,200)})}}}angular.module("graphdb.framework.utils.notifications",[]).factory("Notifications",t),t.$inject=["toastr","$translate"]},93:function(n,e,t){"use strict";t.r(e);t(4),t(10),t(13),t(40);function r(n,e,t,r,o,i){n.getSqlConfigurations=function(){!e.getActiveRepository()||e.isActiveRepoOntopType()||e.isActiveRepoFedXType()?n.jdbcConfigurations=[]:t.getJdbcConfigurations().success((function(e){n.jdbcConfigurations=e})).error((function(n){const e=getError(n);r.error(e,i.instant("jdbc.not.get.SQL.msg"))}))},n.$watch((function(){return e.getActiveRepository()}),(function(){n.getSqlConfigurations()})),n.deleteConfiguration=function(e){o.openSimpleModal({title:i.instant("common.warning"),message:i.instant("jdbc.delete.sql.table.warning.msg",{name:e}),warning:!0}).result.then((function(){t.deleteJdbcConfiguration(e).success((function(){n.getSqlConfigurations()})).error((function(n){r.error(getError(n),i.instant("jdbc.not.delete.sql.msg"))}))}))}}function o(n,e,t,r,o,i,s,u,c,a,l){n.name=e.search().name||"",n.getNamespaces=function(){y(!0,l.instant("common.refreshing.namespaces"),l.instant("common.extra.message")),u.getRepositoryNamespaces().success((function(e){const t={};e.results.bindings.forEach((function(n){t[n.prefix.value]=n.namespace.value})),n.namespaces=t})).error((function(e){n.repositoryError=getError(e)})).finally((function(){y(!1),w()}))},n.setLoader=y,n.addKnownPrefixes=C,n.page=1,n.noPadding={paddingRight:0,paddingLeft:0},n.sqlTypes=["string","iri","boolean","byte","short","int","long","float","double","decimal","date","time","timestamp","Get suggestion..."],n.currentTabConfig={},n.orientationViewMode=!0,n.currentQuery={},n.$watch((function(){return r.getActiveRepository()}),(function(n,t){n!==t&&e.path("jdbc")}));let g=null;n.goBack=function(){g=i((function(){o.history.back()}),1e3)};const f=n.$on("$locationChangeStart",(function(e){!function(e){n.currentQuery.isPristine||(confirm(l.instant("jdbc.warning.unsaved.changes"))?(window.removeEventListener("beforeunload",d),f(),i.cancel(g)):e.preventDefault())}(e)}));function d(e){n.currentQuery.isPristine||(e.returnValue=!0)}window.addEventListener("beforeunload",d),n.$on("$destroy",(function(n){window.removeEventListener("beforeunload",d),f(),i.cancel(g)}));const m={id:"1",name:"",query:"PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n\n# Selects two variables to use as columns\nSELECT ?id ?label {\n    ?id rdfs:label ?label\n    # The following placeholder must be present in the query\n    #!filter\n}",inference:!0,sameAs:!0,isNewConfiguration:!0,isPristine:!0};var p;function y(e,t,r){const o=angular.element(document.getElementById("yasr-inner"));n.queryIsRunning=e,e?(n.queryStartTime=Date.now(),n.countTimeouted=!1,n.progressMessage=t,n.extraMessage=r,o.addClass("hide")):(n.progressMessage="",n.extraMessage="",o.removeClass("hide")),null===n.$$phase&&n.$apply()}function w(){n.tabsData=[n.currentQuery];const e=n.currentQuery;n.currentQuery.query?window.editor.setValue(n.currentQuery.query):window.editor.setValue(" "),i((function(){n.currentTabConfig={},n.currentTabConfig.queryType=e.queryType,n.currentTabConfig.resultsCount=e.resultsCount,n.currentTabConfig.offset=e.offset,n.currentTabConfig.allResultsCount=e.allResultsCount,n.currentTabConfig.page=e.page,n.currentTabConfig.pageSize=e.pageSize,n.currentTabConfig.timeFinished=e.timeFinished,n.currentTabConfig.timeTook=e.timeTook,n.currentTabConfig.sizeDelta=e.sizeDelta,n.$apply()}),0),n.canWriteActiveRepo()||(window.editor.options.readOnly=!0)}function b(){n.tabsData=n.tabs=[m],n.currentQuery=angular.copy(m),h(),window.editor&&(n.setQuery(n.currentQuery.query),w()),n.$watch((function(){return n.currentQuery.query}),(function(e,t){e!==t&&n.setDirty()}))}function C(){c.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success((function(n){angular.isDefined(window.editor)&&angular.isDefined(n)&&n!==window.editor.getValue()&&window.editor.setValue(n)})).error((function(n){const e=getError(n);return t.error(e,l.instant("common.add.known.prefixes.error")),!0}))}function v(){j()&&s.getColumnNames(n.currentQuery.query).success((function(e){s.getColumnsTypeSuggestion(n.currentQuery.query,e).success((function(t){const r=[];_.forEach(e,(function(n){r.push({column_name:n,column_type:t[n].column_type,nullable:!0,sparql_type:t[n].sparql_type})})),n.currentQuery.columns=r,n.setDirty()})).error((function(n){t.error(getError(n),l.instant("jdbc.not.suggest.column.types"))}))})).error((function(n){t.error(getError(n),l.instant("jdbc.not.suggest.column.names"))}))}function h(){2===n.page?n.viewMode="editor":n.viewMode="none"}function Q(n,e,t,r,o){let i=t[r].value;i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return"<div class = 'literal-cell'>"+("<p class='nonUri' style='border: none; background-color: transparent; padding: 0; margin: 0'>"+i+"</p>")+"</div>"}function T(){return window.editor&&"SELECT"===window.editor.getQueryType()}function q(){return j()&&function(){if(!n.currentQuery.columns||!n.currentQuery.columns.length)return t.error(l.instant("jdbc.warning.one.column.msg"),l.instant("jdbc.invalid.columns")),!1;if(n.containsUnknownColumns())return t.error(l.instant("jdbc.warning.all.column.msg"),l.instant("jdbc.invalid.columns")),!1;return!0}()}function j(){return!!T()||(t.error(l.instant("jdbc.warning.invalid.query"),l.instant("jdbc.invalid.query)")),!1)}n.resetCurrentTabConfig=function(){n.currentTabConfig={pageSize:100,page:1,allResultsCount:0,resultsCount:0,queryType:""}},n.saveTab=function(){},n.setQuery=function(n){window.editor.setValue(n||" ")},n.name?(p=n.name,s.getJdbcConfiguration(p).success((function(n){m.query=n.query,m.name=n.name,m.columns=n.columns,m.isNewConfiguration=!n.name,b()})).error((function(n){const e=getError(n);t.error(e,l.instant("jdbc.not.get.sql.msg2"))}))):b(),n.goToPage=function(e){n.page=e;const t=n.currentQuery.columns;2!==e||t&&0!==t.length||!T()||n.getColumnsSuggestions(),h()},n.save=function(){q()&&(n.currentQuery.name?n.currentQuery.isNewConfiguration?s.createNewJdbcConfiguration(n.currentQuery).success((function(){n.currentQuery.isPristine=!0,n.currentQuery.isNewConfiguration=!1,t.success(l.instant("jdbc.saved.configuration")),n.goBack()})).error((function(n){const e=getError(n);t.error(e,l.instant("jdbc.not.saved.configuration"))})):s.updateJdbcConfiguration(n.currentQuery).success((function(){n.currentQuery.isPristine=!0,n.currentQuery.isNewConfiguration=!1,t.success(l.instant("jdbc.configuration.updated")),n.goBack()})).error((function(n){const e=getError(n);t.error(e,l.instant("jdbc.not.saved.configuration"))})):t.error(l.instant("jdbc.required.configuration.name")))},n.hasPrecision=function(n){return"iri"===n||"string"===n||"decimal"===n},n.containsColumnsWithPrecision=function(e){return e&&e.some(e=>n.hasPrecision(e.column_type))},n.hasScale=function(n){return"decimal"===n},n.containsColumnsWithScale=function(e){return e&&e.some(e=>n.hasScale(e.column_type))},n.isLiteral=function(n){return"iri"!==n&&"unknown"!==n},n.containsNonLiteralColumnsOnly=function(e){return e&&e.every(e=>!n.isLiteral(e.column_type))},n.containsUnknownColumns=function(){return n.currentQuery.columns&&n.currentQuery.columns.find(n=>"unknown"===n.column_type)},$("textarea").on("paste",(function(){i((function(){C()}),0)})),n.selectColumnType=function(e,r){const o=_.find(n.currentQuery.columns,(function(n){return n.column_name===e}));"Get suggestion..."===o.column_type&&s.getColumnsTypeSuggestion(n.currentQuery.query,[e]).success((function(n){o.column_type=n[e].column_type,o.column_type===r?t.info(l.instant("jdbc.same.suggested.sql.type",{type:o.column_type}),l.instant("jdbc.suggest.sql.type"),{allowHtml:!0}):t.success(l.instant("jdbc.suggested.sql.type",{type:o.column_type}),l.instant("jdbc.suggest.sql.type"),{allowHtml:!0}),o.sparql_type=n[e].sparql_type})).error((function(n){t.error(getError(n),l.instant("jdbc.not.suggest.column.type"))})),n.setDirty()},n.getColumnsSuggestions=function(){n.currentQuery.columns&&n.currentQuery.columns.length>0?a.openSimpleModal({title:l.instant("common.warning"),message:l.instant("jdbc.warning.column.type.msg"),warning:!0}).result.then((function(){v()})):v()},n.deleteColumn=function(e,t){a.openSimpleModal({title:l.instant("common.warning"),message:l.instant("jdbc.warning.delete.column.msg",{columnName:e}),warning:!0}).result.then((function(){n.currentQuery.columns.splice(t,1),n.setDirty()}))},n.getPreview=function(){if(q()&&(n.executedQueryTab=n.currentQuery,!n.queryIsRunning)){n.currentQuery.outputType="table",n.resetCurrentTabConfig(),y(!0,l.instant("jdbc.preview.first.rows",{name:n.name}),l.instant("common.extra.message"));const e=function(e,r,o){!function(e,r,o){e.results&&e.results.bindings&&e.results.bindings.length?(window.yasr.plugins.table.options.getCellContent=Q,n.currentTabConfig.queryType="SELECT",window.yasr.setResponse(r,o,null)):t.info(l.instant("jdbc.table.definition"),l.instant("jdbc.preview.sql"))}(e,o,r),y(!1)},r=function(n){y(!1),t.error(getError(n,0,100),l.instant("jdbc.not.show.preview"))};if(n.canWriteActiveRepo()){const t=JSON.stringify({name:n.currentQuery.name,query:n.currentQuery.query,columns:n.currentQuery.columns||[]});s.getNewSqlTablePreview(t).done(e).fail(r)}else s.getExistingSqlTablePreview(n.currentQuery.name).done(e).fail(r)}},n.setDirty=function(){n.currentQuery.isPristine=!1},n.getTypeLabel=function(n){switch(n){case"iri":return"VARCHAR: IRI";case"string":return"VARCHAR: String";default:return n.indexOf(" ")>0?n:n.toUpperCase()}}}angular.module("graphdb.framework.jdbc.controllers",["ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.rest.monitoring.service","toastr"],["graphdb.framework.utils.notifications"]).controller("JdbcListCtrl",r).controller("JdbcCreateCtrl",o),r.$inject=["$scope","$repositories","JdbcRestService","toastr","ModalService","$translate"],o.$inject=["$scope","$location","toastr","$repositories","$window","$timeout","JdbcRestService","RDF4JRepositoriesRestService","SparqlRestService","ModalService","$translate"]}}]);